<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Desigualdades con Gráfico</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
    }
    input, button {
      padding: 8px;
      font-size: 16px;
    }
    #resultado {
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Resolver desigualdades lineales y cuadráticas</h1>
  <p>Ejemplos: <code>2x + 3 &lt; 7</code> | <code>x^2 - 4 &gt; 0</code></p>

  <input type="text" id="desigualdad" placeholder="Ej: x^2 - 4 > 0" size="35">
  <button onclick="resolver()">Resolver</button>

  <div id="resultado"></div>
  <div id="grafico" style="width:100%;max-width:700px;height:400px;"></div>

  <script>
    function resolver() {
      const entrada = document.getElementById("desigualdad").value.replace(/\s/g, '');
      const resultado = document.getElementById("resultado");

      const match = entrada.match(/(.*)(<=|>=|<|>)(.*)/);
      if (!match) {
        resultado.innerHTML = "❌ Formato inválido. Usa <, >, <=, >=";
        return;
      }

      let [_, izquierda, operador, derecha] = match;
      const expr = `${izquierda} - (${derecha})`;
      const esCuadratica = expr.includes("x^2");
      const valoresX = [];
      const valoresY = [];

      for (let x = -10; x <= 10; x += 0.1) {
        const y = evaluarExpresion(expr, x);
        valoresX.push(x);
        valoresY.push(y);
      }

      graficar(valoresX, valoresY, expr);

      if (esCuadratica) {
        try {
          const a = parseFloat(expr.match(/([+-]?\d*\.?\d*)x\^2/)?.[1] || 1);
          const b = parseFloat((expr.match(/([+-]?\d*\.?\d*)x(?![\^])/g) || ['0'])[0]);
          const c = parseFloat(expr
            .replace(/([+-]?\d*\.?\d*)x\^2/, '')
            .replace(/([+-]?\d*\.?\d*)x(?![\^])/, '') || 0);

          const disc = b*b - 4*a*c;

          if (disc < 0) {
            resultado.innerHTML = "La desigualdad no tiene solución real.";
          } else {
            const x1 = (-b + Math.sqrt(disc)) / (2*a);
            const x2 = (-b - Math.sqrt(disc)) / (2*a);
            const menor = Math.min(x1, x2).toFixed(2);
            const mayor = Math.max(x1, x2).toFixed(2);

            let sol = "";
            if (operador === ">") sol = `x < ${menor} o x > ${mayor}`;
            if (operador === "<") sol = `${menor} < x < ${mayor}`;
            if (operador === ">=") sol = `x ≤ ${menor} o x ≥ ${mayor}`;
            if (operador === "<=") sol = `${menor} ≤ x ≤ ${mayor}`;

            resultado.innerHTML = `Solución: ${sol}`;
          }
        } catch {
          resultado.innerHTML = "❌ No se pudo analizar la cuadrática.";
        }
      } else {
        // Aproximación para desigualdad lineal
        let ejemplo = '';
        for (let x = -10; x <= 10; x++) {
          const val1 = evaluarExpresion(izquierda, x);
          const val2 = evaluarExpresion(derecha, x);
          let cumple = false;

          switch (operador) {
            case "<": cumple = val1 < val2; break;
            case ">": cumple = val1 > val2; break;
            case "<=": cumple = val1 <= val2; break;
            case ">=": cumple = val1 >= val2; break;
          }

          if (cumple) {
            ejemplo = `Se cumple para x = ${x}`;
            break;
          }
        }
        resultado.innerHTML = ejemplo || "No se cumple la desigualdad para x entre -10 y 10.";
      }
    }

    function evaluarExpresion(expr, x) {
      try {
        return eval(expr.replace(/x/g, `(${x})`));
      } catch {
        return NaN;
      }
    }

    function graficar(x, y, expresion) {
      const trace = {
        x: x,
        y: y,
        mode: 'lines',
        name: expresion,
        line: {color: 'blue'}
      };

      const layout = {
        title: `Gráfico de: f(x) = ${expresion}`,
        xaxis: {title: 'x'},
        yaxis: {title: 'f(x)'},
        showlegend: false
      };

      Plotly.newPlot('grafico', [trace], layout);
    }
  </script>
</body>
</html>
